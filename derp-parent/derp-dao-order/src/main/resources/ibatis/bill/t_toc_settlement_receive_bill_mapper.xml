<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE mapper PUBLIC '-//mybatis.org//DTD Mapper 3.0//EN'
'http://mybatis.org/dtd/mybatis-3-mapper.dtd'>

<mapper namespace='com.topideal.mapper.bill.TocSettlementReceiveBillMapper'>

        <!-- 关系映射 -->
        <resultMap id="TocSettlementReceiveBillModelMap" type="TocSettlementReceiveBillModel" >
                <result property="id" column="id" />
                <result property="code" column="code" />
                <result property="shopTypeCode" column="shop_type_code" />
                <result property="merchantId" column="merchant_id" />
                <result property="merchantName" column="merchant_name" />
                <result property="customerId" column="customer_id" />
                <result property="customerName" column="customer_name" />
                <result property="shopCode" column="shop_code" />
                <result property="shopName" column="shop_name" />
                <result property="storePlatformCode" column="store_platform_code" />
                <result property="buId" column="bu_id" />
                <result property="buName" column="bu_name" />
                <result property="settlementDate" column="settlement_date" />
                <result property="settlementCurrency" column="settlement_currency" />
                <result property="billStatus" column="bill_status" />
                <result property="createrId" column="creater_id" />
                <result property="creater" column="creater" />
                <result property="ncStatus" column="nc_status" />
                <result property="ncSynDate" column="nc_syn_date" />
                <result property="ncCode" column="nc_code" />
                <result property="voucherCode" column="voucher_code" />
                <result property="voucherName" column="voucher_name" />
                <result property="voucherIndex" column="voucher_index" />
                <result property="voucherStatus" column="voucher_status" />
                <result property="period" column="period" />
                <result property="filePath" column="file_path" />
                <result property="errorMsgPath" column="error_msg_path" />
                <result property="createDate" column="create_date" />
                <result property="modifyDate" column="modify_date" />
                <result property="receivableAmount" column="receivable_amount" />
                <result property="oriReceivableAmount" column="ori_receivable_amount" />
                <result property="invoiceStatus" column="invoice_status" />
                <result property="invoiceId" column="invoice_id" />
                <result property="invoiceNo" column="invoice_no" />
                <result property="externalCode" column="external_code" />
                <result property="oriCurrency" column="ori_currency" />
                <result property="billInDate" column="bill_in_date" />
        </resultMap>

    <!-- 查询所有信息 -->
    <select id="list" resultMap='TocSettlementReceiveBillModelMap' parameterType='TocSettlementReceiveBillModel'>
        select <include refid='sql_columns' /> from t_toc_settlement_receive_bill  <include refid='sql_where' />
    </select>

    <!-- 查询所有信息 分页 -->
    <select id='listByPage' resultMap='TocSettlementReceiveBillModelMap' parameterType='TocSettlementReceiveBillModel'>
        select <include refid='sql_columns' /> from t_toc_settlement_receive_bill  <include refid='sql_where' />
    </select>

    <!-- 条件查询 -->
    <select id='get' resultMap='TocSettlementReceiveBillModelMap' parameterType='TocSettlementReceiveBillModel' >
        select <include refid='sql_columns' /> from t_toc_settlement_receive_bill  <include refid='sql_where' />
    </select>

        <!-- 新增数据 -->
        <insert id='insert' parameterType='TocSettlementReceiveBillModel' keyProperty="id" useGeneratedKeys="true">
            INSERT INTO t_toc_settlement_receive_bill
            <trim prefix="(" suffix=")" suffixOverrides="," >
                        <if test='id!=null' >id , </if>
                        <if test='code!=null and !"".equals(code)' > code , </if>
                        <if test='shopTypeCode!=null and !"".equals(shopTypeCode)' > shop_type_code , </if>
                        <if test='merchantId!=null' >merchant_id , </if>
                        <if test='merchantName!=null and !"".equals(merchantName)' > merchant_name , </if>
                        <if test='customerId!=null' >customer_id , </if>
                        <if test='customerName!=null and !"".equals(customerName)' > customer_name , </if>
                        <if test='shopCode!=null and !"".equals(shopCode)' > shop_code , </if>
                        <if test='shopName!=null and !"".equals(shopName)' > shop_name , </if>
                        <if test='storePlatformCode!=null and !"".equals(storePlatformCode)' > store_platform_code , </if>
                        <if test='buId!=null' >bu_id , </if>
                        <if test='buName!=null and !"".equals(buName)' > bu_name , </if>
                        <if test='settlementDate!=null' >settlement_date , </if>
                        <if test='settlementCurrency!=null and !"".equals(settlementCurrency)' > settlement_currency , </if>
                        <if test='billStatus!=null and !"".equals(billStatus)' > bill_status , </if>
                        <if test='createrId!=null' >creater_id , </if>
                        <if test='creater!=null and !"".equals(creater)' > creater , </if>
                        <if test='ncStatus!=null and !"".equals(ncStatus)' > nc_status , </if>
                        <if test='ncSynDate!=null' >nc_syn_date , </if>
                        <if test='ncCode!=null and !"".equals(ncCode)' > nc_code , </if>
                        <if test='voucherCode!=null and !"".equals(voucherCode)' > voucher_code , </if>
                        <if test='voucherName!=null and !"".equals(voucherName)' > voucher_name , </if>
                        <if test='voucherIndex!=null and !"".equals(voucherIndex)' > voucher_index , </if>
                        <if test='voucherStatus!=null and !"".equals(voucherStatus)' > voucher_status , </if>
                        <if test='period!=null and !"".equals(period)' > period , </if>
                        <if test='filePath!=null and !"".equals(filePath)' > file_path , </if>
                        <if test='errorMsgPath!=null and !"".equals(errorMsgPath)' > error_msg_path , </if>
                        <if test='createDate!=null' >create_date , </if>
                        <if test='modifyDate!=null' >modify_date , </if>
                        <if test='receivableAmount!=null' >receivable_amount , </if>
                        <if test='oriReceivableAmount!=null' >ori_receivable_amount , </if>
                        <if test='invoiceStatus!=null and !"".equals(invoiceStatus)' > invoice_status , </if>
                        <if test='invoiceId!=null' >invoice_id , </if>
                        <if test='invoiceNo!=null and !"".equals(invoiceNo)' > invoice_no , </if>
                        <if test='externalCode!=null and !"".equals(externalCode)' > external_code , </if>
                        <if test='oriCurrency!=null and !"".equals(oriCurrency)' > ori_currency , </if>
                        <if test='billInDate!=null' >bill_in_date , </if>
            </trim>
            VALUES
            <trim prefix="(" suffix=")" suffixOverrides="," >
                        <if test='id!=null' > #{id} , </if>
                        <if test='code!=null and !"".equals(code)' > #{code} , </if>
                        <if test='shopTypeCode!=null and !"".equals(shopTypeCode)' > #{shopTypeCode} , </if>
                        <if test='merchantId!=null' > #{merchantId} , </if>
                        <if test='merchantName!=null and !"".equals(merchantName)' > #{merchantName} , </if>
                        <if test='customerId!=null' > #{customerId} , </if>
                        <if test='customerName!=null and !"".equals(customerName)' > #{customerName} , </if>
                        <if test='shopCode!=null and !"".equals(shopCode)' > #{shopCode} , </if>
                        <if test='shopName!=null and !"".equals(shopName)' > #{shopName} , </if>
                        <if test='storePlatformCode!=null and !"".equals(storePlatformCode)' > #{storePlatformCode} , </if>
                        <if test='buId!=null' > #{buId} , </if>
                        <if test='buName!=null and !"".equals(buName)' > #{buName} , </if>
                        <if test='settlementDate!=null' > #{settlementDate} , </if>
                        <if test='settlementCurrency!=null and !"".equals(settlementCurrency)' > #{settlementCurrency} , </if>
                        <if test='billStatus!=null and !"".equals(billStatus)' > #{billStatus} , </if>
                        <if test='createrId!=null' > #{createrId} , </if>
                        <if test='creater!=null and !"".equals(creater)' > #{creater} , </if>
                        <if test='ncStatus!=null and !"".equals(ncStatus)' > #{ncStatus} , </if>
                        <if test='ncSynDate!=null' > #{ncSynDate} , </if>
                        <if test='ncCode!=null and !"".equals(ncCode)' > #{ncCode} , </if>
                        <if test='voucherCode!=null and !"".equals(voucherCode)' > #{voucherCode} , </if>
                        <if test='voucherName!=null and !"".equals(voucherName)' > #{voucherName} , </if>
                        <if test='voucherIndex!=null and !"".equals(voucherIndex)' > #{voucherIndex} , </if>
                        <if test='voucherStatus!=null and !"".equals(voucherStatus)' > #{voucherStatus} , </if>
                        <if test='period!=null and !"".equals(period)' > #{period} , </if>
                        <if test='filePath!=null and !"".equals(filePath)' > #{filePath} , </if>
                        <if test='errorMsgPath!=null and !"".equals(errorMsgPath)' > #{errorMsgPath} , </if>
                        <if test='createDate!=null' > #{createDate} , </if>
                        <if test='modifyDate!=null' > #{modifyDate} , </if>
                        <if test='receivableAmount!=null' > #{receivableAmount} , </if>
                        <if test='oriReceivableAmount!=null' > #{oriReceivableAmount} , </if>
                        <if test='invoiceStatus!=null and !"".equals(invoiceStatus)' > #{invoiceStatus} , </if>
                        <if test='invoiceId!=null' > #{invoiceId} , </if>
                        <if test='invoiceNo!=null and !"".equals(invoiceNo)' > #{invoiceNo} , </if>
                        <if test='externalCode!=null and !"".equals(externalCode)' > #{externalCode} , </if>
                        <if test='oriCurrency!=null and !"".equals(oriCurrency)' > #{oriCurrency} , </if>
                        <if test='billInDate!=null' > #{billInDate} , </if>
            </trim>
        </insert>

        <!-- 修改数据 -->
        <update id='update' parameterType='TocSettlementReceiveBillModel' keyProperty="id" useGeneratedKeys="true">
            UPDATE  t_toc_settlement_receive_bill SET
            <trim  suffixOverrides=",">
                        <if test='id!=null' > id= #{id} , </if>
                        <if test='code!=null and !"".equals(code)' >code= #{code} , </if>
                        <if test='shopTypeCode!=null and !"".equals(shopTypeCode)' >shop_type_code= #{shopTypeCode} , </if>
                        <if test='merchantId!=null' > merchant_id= #{merchantId} , </if>
                        <if test='merchantName!=null and !"".equals(merchantName)' >merchant_name= #{merchantName} , </if>
                        <if test='customerId!=null' > customer_id= #{customerId} , </if>
                        <if test='customerName!=null and !"".equals(customerName)' >customer_name= #{customerName} , </if>
                        <if test='shopCode!=null and !"".equals(shopCode)' >shop_code= #{shopCode} , </if>
                        <if test='shopName!=null and !"".equals(shopName)' >shop_name= #{shopName} , </if>
                        <if test='storePlatformCode!=null and !"".equals(storePlatformCode)' >store_platform_code= #{storePlatformCode} , </if>
                        <if test='buId!=null' > bu_id= #{buId} , </if>
                        <if test='buName!=null and !"".equals(buName)' >bu_name= #{buName} , </if>
                        <if test='settlementDate!=null' > settlement_date= #{settlementDate} , </if>
                        <if test='settlementCurrency!=null and !"".equals(settlementCurrency)' >settlement_currency= #{settlementCurrency} , </if>
                        <if test='billStatus!=null and !"".equals(billStatus)' >bill_status= #{billStatus} , </if>
                        <if test='createrId!=null' > creater_id= #{createrId} , </if>
                        <if test='creater!=null and !"".equals(creater)' >creater= #{creater} , </if>
                        <if test='ncStatus!=null and !"".equals(ncStatus)' >nc_status= #{ncStatus} , </if>
                        <if test='ncSynDate!=null' > nc_syn_date= #{ncSynDate} , </if>
                        <if test='ncCode!=null and !"".equals(ncCode)' >nc_code= #{ncCode} , </if>
                        <if test='voucherCode!=null and !"".equals(voucherCode)' >voucher_code= #{voucherCode} , </if>
                        <if test='voucherName!=null and !"".equals(voucherName)' >voucher_name= #{voucherName} , </if>
                        <if test='voucherIndex!=null and !"".equals(voucherIndex)' >voucher_index= #{voucherIndex} , </if>
                        <if test='voucherStatus!=null and !"".equals(voucherStatus)' >voucher_status= #{voucherStatus} , </if>
                        <if test='period!=null and !"".equals(period)' >period= #{period} , </if>
                        <if test='filePath!=null and !"".equals(filePath)' >file_path= #{filePath} , </if>
                        <if test='errorMsgPath!=null and !"".equals(errorMsgPath)' >error_msg_path= #{errorMsgPath} , </if>
                        <if test='createDate!=null' > create_date= #{createDate} , </if>
                        <if test='modifyDate!=null' > modify_date= #{modifyDate} , </if>
                        <if test='receivableAmount!=null' > receivable_amount= #{receivableAmount} , </if>
                        <if test='oriReceivableAmount!=null' > ori_receivable_amount= #{oriReceivableAmount} , </if>
                        <if test='invoiceStatus!=null and !"".equals(invoiceStatus)' >invoice_status= #{invoiceStatus} , </if>
                        <if test='invoiceId!=null' > invoice_id= #{invoiceId} , </if>
                        <if test='invoiceNo!=null and !"".equals(invoiceNo)' >invoice_no= #{invoiceNo} , </if>
                        <if test='externalCode!=null and !"".equals(externalCode)' >external_code= #{externalCode} , </if>
                        <if test='oriCurrency!=null and !"".equals(oriCurrency)' >ori_currency= #{oriCurrency} , </if>
                        <if test='billInDate!=null' > bill_in_date= #{billInDate} , </if>
            </trim>
            <where>
                id=#{id}
            </where>
        </update>

    <!-- 删除数据 -->
    <delete id='del' parameterType='java.lang.Long'>
        delete from t_toc_settlement_receive_bill  where id=#{id}
    </delete>

        <!-- 批量删除数据 -->
        <delete id='batchDel' parameterType='java.util.ArrayList'>
            delete from t_toc_settlement_receive_bill where id in
            <foreach collection='list' item='id' separator=',' open='(' close=')'>
            #{id}
            </foreach>
        </delete>

        <!-- 表字段 -->
        <sql id='sql_columns'>
            id,
            code,
            shop_type_code,
            merchant_id,
            merchant_name,
            customer_id,
            customer_name,
            shop_code,
            shop_name,
            store_platform_code,
            bu_id,
            bu_name,
            settlement_date,
            settlement_currency,
            bill_status,
            creater_id,
            creater,
            nc_status,
            nc_syn_date,
            nc_code,
            voucher_code,
            voucher_name,
            voucher_index,
            voucher_status,
            period,
            file_path,
            error_msg_path,
            create_date,
            modify_date,
            receivable_amount,
            ori_receivable_amount,
            invoice_status,
            invoice_id,
            invoice_no,
            external_code,
            ori_currency,
            bill_in_date
        </sql>

        <!-- 查询条件 -->
        <sql id='sql_where'>
            <where>
                <trim suffixOverrides='and'>
                            <if test='id!=null' > id= #{id} and </if>
                            <if test='code!=null and !"".equals(code)' >code= #{code} and </if>
                            <if test='shopTypeCode!=null and !"".equals(shopTypeCode)' >shop_type_code= #{shopTypeCode} and </if>
                            <if test='merchantId!=null' > merchant_id= #{merchantId} and </if>
                            <if test='merchantName!=null and !"".equals(merchantName)' >merchant_name= #{merchantName} and </if>
                            <if test='customerId!=null' > customer_id= #{customerId} and </if>
                            <if test='customerName!=null and !"".equals(customerName)' >customer_name= #{customerName} and </if>
                            <if test='shopCode!=null and !"".equals(shopCode)' >shop_code= #{shopCode} and </if>
                            <if test='shopName!=null and !"".equals(shopName)' >shop_name= #{shopName} and </if>
                            <if test='storePlatformCode!=null and !"".equals(storePlatformCode)' >store_platform_code= #{storePlatformCode} and </if>
                            <if test='buId!=null' > bu_id= #{buId} and </if>
                            <if test='buName!=null and !"".equals(buName)' >bu_name= #{buName} and </if>
                            <if test='settlementDate!=null' > settlement_date= #{settlementDate} and </if>
                            <if test='settlementCurrency!=null and !"".equals(settlementCurrency)' >settlement_currency= #{settlementCurrency} and </if>
                            <if test='billStatus!=null and !"".equals(billStatus)' >bill_status= #{billStatus} and </if>
                            <if test='createrId!=null' > creater_id= #{createrId} and </if>
                            <if test='creater!=null and !"".equals(creater)' >creater= #{creater} and </if>
                            <if test='ncStatus!=null and !"".equals(ncStatus)' >nc_status= #{ncStatus} and </if>
                            <if test='ncSynDate!=null' > nc_syn_date= #{ncSynDate} and </if>
                            <if test='ncCode!=null and !"".equals(ncCode)' >nc_code= #{ncCode} and </if>
                            <if test='voucherCode!=null and !"".equals(voucherCode)' >voucher_code= #{voucherCode} and </if>
                            <if test='voucherName!=null and !"".equals(voucherName)' >voucher_name= #{voucherName} and </if>
                            <if test='voucherIndex!=null and !"".equals(voucherIndex)' >voucher_index= #{voucherIndex} and </if>
                            <if test='voucherStatus!=null and !"".equals(voucherStatus)' >voucher_status= #{voucherStatus} and </if>
                            <if test='period!=null and !"".equals(period)' >period= #{period} and </if>
                            <if test='filePath!=null and !"".equals(filePath)' >file_path= #{filePath} and </if>     
                            <if test='errorMsgPath!=null and !"".equals(errorMsgPath)' >error_msg_path= #{errorMsgPath} and </if>
                            <if test='createDate!=null' > create_date= #{createDate} and </if>
                            <if test='modifyDate!=null' > modify_date= #{modifyDate} and </if>
                            <if test='receivableAmount!=null' > receivable_amount= #{receivableAmount} and </if>
                            <if test='oriReceivableAmount!=null' > ori_receivable_amount= #{oriReceivableAmount} and </if>
                            <if test='invoiceStatus!=null and !"".equals(invoiceStatus)' >invoice_status= #{invoiceStatus} and </if>
                            <if test='invoiceId!=null' > invoice_id= #{invoiceId} and </if>
                            <if test='invoiceNo!=null and !"".equals(invoiceNo)' >invoice_no= #{invoiceNo} and </if>
                            <if test='externalCode!=null and !"".equals(externalCode)' >external_code= #{externalCode} and </if>
                            <if test='oriCurrency!=null and !"".equals(oriCurrency)' >ori_currency= #{oriCurrency} and </if>
                            <if test='billInDate!=null' > bill_in_date= #{billInDate} and </if>
                </trim>
            </where>
        </sql>

        <!--自定义SQL-->
        <sql id='dto_sql_where'>
            <where>
                <trim suffixOverrides='and'>
                    <choose>
                        <when test='ids!=null and !"".equals(ids)'>
                            id in
                            <foreach collection="ids.split(',')" open="(" close=")" separator="," item="id">
                                #{id}
                            </foreach>
                        </when>
                        <otherwise>
                            <if test='buList!=null and !"".equals(buList)'>bu_id in
                                <foreach collection='buList' item='buId' separator=',' open='(' close=')'>
                                    #{buId}
                                </foreach>
                                and
                            </if>
                            <if test='billStatusList!=null and billStatusList.size() > 0'>bill_status in
                                <foreach collection='billStatusList' item='billStatus' separator=',' open='(' close=')'>
                                    #{billStatus}
                                </foreach>
                                and
                            </if>
                            <if test='id!=null'>id= #{id} and</if>
                            <if test='code!=null and !"".equals(code)'>code= #{code} and</if>
                            <if test='shopTypeCode!=null and !"".equals(shopTypeCode)'>shop_type_code= #{shopTypeCode}
                                and
                            </if>
                            <if test='merchantId!=null'>merchant_id= #{merchantId} and</if>
                            <if test='merchantName!=null and !"".equals(merchantName)'>merchant_name= #{merchantName}
                                and
                            </if>
                            <if test='customerId!=null'>customer_id= #{customerId} and</if>
                            <if test='customerName!=null and !"".equals(customerName)'>customer_name= #{customerName}
                                and
                            </if>
                            <if test='shopCode!=null and !"".equals(shopCode)'>shop_code= #{shopCode} and</if>
                            <if test='shopName!=null and !"".equals(shopName)'>shop_name= #{shopName} and</if>
                            <if test='storePlatformCode!=null and !"".equals(storePlatformCode)' >store_platform_code= #{storePlatformCode} and </if>
                            <if test='buId!=null' > bu_id= #{buId} and </if>
                            <if test='buName!=null and !"".equals(buName)' >bu_name= #{buName} and </if>
                            <if test='settlementDate!=null' > settlement_date= #{settlementDate} and </if>
                            <if test='settlementCurrency!=null and !"".equals(settlementCurrency)' >settlement_currency= #{settlementCurrency} and </if>
                            <if test='billStatus!=null and !"".equals(billStatus)' >bill_status= #{billStatus} and </if>
                            <if test='createrId!=null' > creater_id= #{createrId} and </if>
                            <if test='creater!=null and !"".equals(creater)' >creater= #{creater} and </if>
                            <if test='ncStatus!=null and !"".equals(ncStatus)' >nc_status= #{ncStatus} and </if>
                            <if test='ncSynDate!=null' > nc_syn_date= #{ncSynDate} and </if>
                            <if test='ncCode!=null and !"".equals(ncCode)' >nc_code= #{ncCode} and </if>
                            <if test='voucherCode!=null and !"".equals(voucherCode)' >voucher_code= #{voucherCode} and </if>
                            <if test='voucherName!=null and !"".equals(voucherName)' >voucher_name= #{voucherName} and </if>
                            <if test='voucherIndex!=null and !"".equals(voucherIndex)' >voucher_index= #{voucherIndex} and </if>
                            <if test='voucherStatus!=null and !"".equals(voucherStatus)' >voucher_status= #{voucherStatus} and </if>
                            <if test='period!=null and !"".equals(period)' >period= #{period} and </if>
                            <if test='filePath!=null and !"".equals(filePath)' >file_path= #{filePath} and </if>
                            <if test='errorMsgPath!=null and !"".equals(errorMsgPath)' >error_msg_path= #{errorMsgPath} and </if>
                            <if test='createDate!=null' > create_date= #{createDate} and </if>
                            <if test='modifyDate!=null' > modify_date= #{modifyDate} and </if>
                            <if test='receivableAmount!=null' > receivable_amount= #{receivableAmount} and </if>
                            <if test='invoiceStatus!=null and !"".equals(invoiceStatus)' >invoice_status= #{invoiceStatus} and </if>
                            <if test='invoiceId!=null' > invoice_id= #{invoiceId} and </if>
                            <if test='invoiceNo!=null and !"".equals(invoiceNo)' >invoice_no= #{invoiceNo} and </if>
                            <if test='externalCode!=null and !"".equals(externalCode)' >external_code= #{externalCode} and </if>
                            <if test='month!=null and !"".equals(month)' >DATE_FORMAT(settlement_date, '%Y-%m')= #{month} and </if>
                        </otherwise>
                    </choose>
                </trim>
            </where>
        </sql>

        <select id="listReceiveBillByPage" resultType="TocSettlementReceiveBillDTO" parameterType="TocSettlementReceiveBillDTO" >
            select <include refid='sql_columns' /> from t_toc_settlement_receive_bill  <include refid='dto_sql_where' />
            order by id desc
        </select>

        <select id="searchDTOById" resultType="TocSettlementReceiveBillDTO" parameterType="java.lang.Long" >
            select <include refid='sql_columns' /> from t_toc_settlement_receive_bill where id = #{id}
        </select>

        <select id="getNcBackfillList" resultType="TocSettlementReceiveBillModel">
            select <include refid='sql_columns' /> from t_toc_settlement_receive_bill
            where nc_status in ('11', '1', '2', '3', '4', '5', '6', '7')
            and bill_status = '06'
            UNION
            select <include refid='sql_columns' /> from t_toc_settlement_receive_bill
            where nc_status in ('11', '1', '2', '3', '4')
            and bill_status != '06'
        </select>

        <select id="getNcVoucherFillBackList" resultType="TocSettlementReceiveBillModel">
            select
            <include refid='sql_columns' /> from t_toc_settlement_receive_bill
            where (bill_status != '06' and nc_status in ('4', '5') and voucher_code is null )
            or (bill_status = '06' and nc_status in ('4', '5', '8', '9'))
        </select>

        <select id="listForExport" resultType="TocSettlementReceiveBillDTO" >
            select <include refid='sql_columns' /> from t_toc_settlement_receive_bill
            <include refid='dto_sql_where' />
            order by id desc
        </select>

        <update id='updateWithNull' parameterType='TocSettlementReceiveBillModel' keyProperty="id" useGeneratedKeys="true">
            UPDATE  t_toc_settlement_receive_bill SET
            <trim  suffixOverrides=",">
                <if test='id!=null' > id= #{id} , </if>
                <if test='code!=null and !"".equals(code)' >code= #{code} , </if>
                <if test='shopTypeCode!=null and !"".equals(shopTypeCode)' >shop_type_code= #{shopTypeCode} , </if>
                <if test='merchantId!=null' > merchant_id= #{merchantId} , </if>
                <if test='merchantName!=null and !"".equals(merchantName)' >merchant_name= #{merchantName} , </if>
                <if test='customerId!=null' > customer_id= #{customerId} , </if>
                <if test='customerName!=null and !"".equals(customerName)' >customer_name= #{customerName} , </if>
                <if test='shopCode!=null and !"".equals(shopCode)' >shop_code= #{shopCode} , </if>
                <if test='shopName!=null and !"".equals(shopName)' >shop_name= #{shopName} , </if>
                <if test='storePlatformCode!=null and !"".equals(storePlatformCode)' >store_platform_code= #{storePlatformCode} , </if>
                <if test='buId!=null' > bu_id= #{buId} , </if>
                <if test='buName!=null and !"".equals(buName)' >bu_name= #{buName} , </if>
                <if test='settlementDate!=null' > settlement_date= #{settlementDate} , </if>
                <if test='settlementCurrency!=null and !"".equals(settlementCurrency)' >settlement_currency= #{settlementCurrency} , </if>
                <if test='billStatus!=null and !"".equals(billStatus)' >bill_status= #{billStatus} , </if>
                <if test='createrId!=null' > creater_id= #{createrId} , </if>
                <if test='creater!=null and !"".equals(creater)' >creater= #{creater} , </if>
                <if test='ncStatus!=null and !"".equals(ncStatus)' >nc_status= #{ncStatus} , </if>
                <if test='ncSynDate!=null' > nc_syn_date= #{ncSynDate} , </if>
                <if test='ncCode!=null and !"".equals(ncCode)' >nc_code= #{ncCode} , </if>
                <if test='voucherCode!=null and !"".equals(voucherCode)' >voucher_code= #{voucherCode} , </if>
                <if test='voucherName!=null and !"".equals(voucherName)' >voucher_name= #{voucherName} , </if>
                <if test='voucherIndex!=null and !"".equals(voucherIndex)' >voucher_index= #{voucherIndex} , </if>
                <if test='voucherStatus!=null and !"".equals(voucherStatus)' >voucher_status= #{voucherStatus} , </if>
                <if test='period!=null and !"".equals(period)' >period= #{period} , </if>
                <if test='filePath!=null and !"".equals(filePath)' >file_path= #{filePath} , </if>
                <if test='createDate!=null' > create_date= #{createDate} , </if>
                <if test='modifyDate!=null' > modify_date= #{modifyDate} , </if>
                <if test='receivableAmount!=null' > receivable_amount= #{receivableAmount} , </if>
                <if test='oriReceivableAmount!=null' > ori_receivable_amount= #{oriReceivableAmount}, </if>
                <if test='oriCurrency!=null and !"".equals(oriCurrency)' >ori_currency= #{oriCurrency} and </if>
                error_msg_path= #{errorMsgPath} ,
            </trim>
            <where>
                id=#{id}
            </where>
        </update>

        <select id="listByIds" resultMap='TocSettlementReceiveBillModelMap' >
            select <include refid='sql_columns' /> from t_toc_settlement_receive_bill
            where id in
            <foreach collection='ids' item='id' separator=',' open='(' close=')'>
                #{id}
            </foreach>
        </select>

        <update id="batchUpdateInvoiceStatus">
            UPDATE  t_toc_settlement_receive_bill SET invoice_status= #{invoiceStatus}
            <if test="invoiceStatus == '00'">
                , invoice_id = null, invoice_no = null
            </if>
            where id IN
            <foreach collection='ids' item='id' separator=',' open='(' close=')'>
                #{id}
            </foreach>
        </update>

        <select id="getRecevieByBillStatus" resultType="map" parameterType="map">
            select t1.thirtyAmount as thirtyAmount,t1.thirtyIds as thirtyIds,
                   t2.sixtyAmount as sixtyAmount,t2.sixtyIds as sixtyIds,
                   t3.ninetyAmount as ninetyAmount,t3.ninetyids as ninetyIds ,
                   t4.onetwentyAmount as onetwentyAmount,t4.twentyIds as twentyIds,
                   t5.twentyAboveAmount as twentyAboveAmount,t5.aboveIds as aboveIds,
                   t6.dayAmount as dayAmount,t6.dayIds as dayIds
            from
            (select IFNULL(sum(receivable_amount),0) thirtyAmount,GROUP_CONCAT(DISTINCT id separator ',') thirtyIds from t_toc_settlement_receive_bill
            where bill_status in('02','03')
                <if test='merchantId!=null' >and merchant_id= #{merchantId}  </if>
                <if test='customerId!=null' >and customer_id= #{customerId} </if>
                <if test='buId!=null' >and bu_id= #{buId} </if>
                <if test='currency!=null and !"".equals(currency)' >and settlement_currency= #{currency} </if>
                <if test='shopTypeCode!=null and !"".equals(shopTypeCode)' >and shop_type_code= #{shopTypeCode} </if>
                and  datediff( now(), settlement_date ) <![CDATA[<=]]>  30)t1,
            (select IFNULL(sum(receivable_amount),0) sixtyAmount,GROUP_CONCAT(DISTINCT id separator ',') sixtyIds from t_toc_settlement_receive_bill
            where bill_status in('02','03')
                <if test='merchantId!=null' >and merchant_id= #{merchantId}  </if>
                <if test='customerId!=null' >and customer_id= #{customerId} </if>
                <if test='buId!=null' >and bu_id= #{buId} </if>
                <if test='currency!=null and !"".equals(currency)' >and settlement_currency= #{currency} </if>
                <if test='shopTypeCode!=null and !"".equals(shopTypeCode)' >and shop_type_code= #{shopTypeCode} </if>
            and  datediff( now(), settlement_date ) >  30
            and datediff( now(), settlement_date )<![CDATA[<=]]> 60 )t2,
            (select IFNULL(sum(receivable_amount),0)  ninetyAmount,GROUP_CONCAT(DISTINCT id separator ',') ninetyids from t_toc_settlement_receive_bill
            where bill_status in('02','03')
                <if test='merchantId!=null' >and merchant_id= #{merchantId}  </if>
                <if test='customerId!=null' >and customer_id= #{customerId} </if>
                <if test='buId!=null' >and bu_id= #{buId} </if>
                <if test='currency!=null and !"".equals(currency)' >and settlement_currency= #{currency} </if>
                <if test='shopTypeCode!=null and !"".equals(shopTypeCode)' >and shop_type_code= #{shopTypeCode} </if>
            and  datediff( now(), settlement_date ) >  60
            and datediff( now(), settlement_date )<![CDATA[<=]]> 90 )t3,
            (select IFNULL(sum(receivable_amount),0)  onetwentyAmount,GROUP_CONCAT(DISTINCT id separator ',') twentyIds from t_toc_settlement_receive_bill
            where bill_status in('02','03')
                <if test='merchantId!=null' >and merchant_id= #{merchantId}  </if>
                <if test='customerId!=null' >and customer_id= #{customerId} </if>
                <if test='buId!=null' >and bu_id= #{buId} </if>
                <if test='currency!=null and !"".equals(currency)' >and settlement_currency= #{currency} </if>
                <if test='shopTypeCode!=null and !"".equals(shopTypeCode)' >and shop_type_code= #{shopTypeCode} </if>
            and  datediff( now(), settlement_date ) >  90
            and datediff( now(), settlement_date )<![CDATA[<=]]> 120 )t4,
            (select IFNULL(sum(receivable_amount),0) twentyAboveAmount,GROUP_CONCAT(DISTINCT id separator ',') aboveIds from t_toc_settlement_receive_bill
            where bill_status in('02','03')
                <if test='merchantId!=null' >and merchant_id= #{merchantId}  </if>
                <if test='customerId!=null' >and customer_id= #{customerId} </if>
                <if test='buId!=null' >and bu_id= #{buId} </if>
                <if test='currency!=null and !"".equals(currency)' >and settlement_currency= #{currency} </if>
                <if test='shopTypeCode!=null and !"".equals(shopTypeCode)' >and shop_type_code= #{shopTypeCode} </if>
            and  datediff( now(), settlement_date ) >  120)t5,
            (select IFNULL(sum(receivable_amount),0) dayAmount,GROUP_CONCAT(DISTINCT id separator ',') dayIds from t_toc_settlement_receive_bill
            where bill_status in('02','03')
                <if test='merchantId!=null' >and merchant_id= #{merchantId}  </if>
                <if test='customerId!=null' >and customer_id= #{customerId} </if>
                <if test='buId!=null' >and bu_id= #{buId} </if>
                <if test='currency!=null and !"".equals(currency)' >and settlement_currency= #{currency} </if>
                <if test='shopTypeCode!=null and !"".equals(shopTypeCode)' >and shop_type_code= #{shopTypeCode} </if>
            and  datediff( now(), settlement_date ) <![CDATA[<=]]> #{day})t6
        </select>


        <!--POP-->
        <select id="getSummarySettlement" resultType="map" parameterType="map">
            select merchant_id merchantId,merchant_name merchantName,customer_id customerId,customer_name customerName,bu_id buId,bu_name buName,store_platform_code storePlatformCode,shop_type_code shopTypeCode,settlement_currency currency from t_toc_settlement_receive_bill
            where bill_status in('02','03') and shop_type_code=#{shopTypeCode}
            <trim suffixOverrides='and'>
                <if test='merchantId!=null' >and merchant_id= #{merchantId}  </if>
                <if test='customerId!=null' >and customer_id= #{customerId} </if>
                <if test='buId!=null' >and bu_id= #{buId} </if>
                <if test='currency!=null and !"".equals(currency)' >and settlement_currency= #{currency} </if>
            </trim>
             group by merchant_id,customer_id,bu_id,settlement_currency
        </select>



        <select id="getItemBySearch" parameterType="map" resultType="Map">
            select date_format(s.settlement_date,'%Y-%m') month,sum(IFNULL(s.receivable_amount- IfNull(t.price,0),0))amount
            from t_toc_settlement_receive_bill s left join
            (select bill_id,ifnull(sum(price),0)price from  t_toc_settlement_receive_bill_verify_item group by bill_id) t
            on s.id = t.bill_id
            where s.bill_status in ('02', '03')
              AND s.shop_type_code = #{shopTypeCode}
              AND s.bu_id = #{buId}
              AND s.merchant_id = #{merchantId}
              AND s.customer_id = #{customerId}
              AND s.settlement_currency = #{currency}
            group by date_format(s.settlement_date, '%Y-%m')
        </select>

    <select id="listTocBill" resultMap="TocSettlementReceiveBillModelMap">
        select
        <include refid='sql_columns'/>
        from t_toc_settlement_receive_bill
        <include refid='dto_sql_where'/>
    </select>

    <update id="batchUpdateBillStatus">
        UPDATE t_toc_settlement_receive_bill SET bill_status= #{billStatus}
        where id IN
        <foreach collection='ids' item='id' separator=',' open='(' close=')'>
            #{id}
        </foreach>
    </update>

    <select id="getReceiveBillList" resultType="TocSettlementReceiveBillModel" >
        select t1.* from t_toc_settlement_receive_bill t1
        LEFT JOIN t_receive_bill_verification t2 ON t1.id=t2.receive_id and t2.bill_type = '1'
        where t1.bill_status in ('02','03','04','05')  and   (t2.uncollected_price !=0 OR t2.uncollected_price is null)
        <if test='receiveCodeList!=null and !"".equals(receiveCodeList) and receiveCodeList.size>0' >
        and  t1.`code` in
        <foreach collection='receiveCodeList' item='receiveCode' separator=',' open='(' close=')'>
            #{receiveCode}
        </foreach>
        </if>
    </select>

    <select id="getZfAnd006ReceiveBill" resultType="TocSettlementReceiveBillModel" >
        select t1.* from t_toc_settlement_receive_bill t1
        LEFT JOIN t_receive_bill_verification t2 ON t1.id=t2.receive_id
        where t1.bill_status in ('06','006') and t2.bill_type = '1'
        <if test='receiveCodes!=null and !"".equals(receiveCodes) and receiveCodes.size>0' >
            and  t1.`code` in
            <foreach collection='receiveCodes' item='receiveCode' separator=',' open='(' close=')'>
                #{receiveCode}
            </foreach>
        </if>
    </select>

    <select id="listByMonthlySnapshot" resultMap="TocSettlementReceiveBillModelMap" >
        select <include refid='sql_columns'/>
        FROM t_toc_settlement_receive_bill
        where merchant_id = #{merchantId}
        and bu_id = #{buId}
        and bill_status in ('02', '03', '05')
        and date_format(bill_in_date, '%Y-%m') &lt;= #{month}
    </select>

    <select id="listByAllVerifyMonthlySnapshot" resultMap="TocSettlementReceiveBillModelMap" >
        select <include refid='sql_columns'/>
        from t_toc_settlement_receive_bill
        where id in (
        SELECT bill_id FROM t_toc_settlement_receive_bill_verify_item
        WHERE verify_month &gt; #{month}
        AND bill_id IN (
        SELECT id FROM t_toc_settlement_receive_bill
        WHERE merchant_id = #{merchantId}
        AND bu_id = #{buId}
        AND bill_status = '04'
        AND date_format( bill_in_date, '%Y-%m' ) &lt;= #{month}
        ))
    </select>
</mapper>